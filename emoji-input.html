<link rel="import" href="../polymer/polymer.html">

<!--
A custom input element with fancy emoji support.

##### Example

<emoji-input></emoji-input>

@element emoji-input
@blurb A custom input element with fancy emoji support.
@status alpha
@homepage http://phothonservices.github.io/emoji-input
-->
<polymer-element name="emoji-input" attributes="notitle author" on-keypress="{{keypressAction}}">
  <template>
    <link rel="stylesheet" href="emoji-input.css" />
    <div id="input" contenteditable="true"></div>
  </template>
  <script>
  Polymer({
    ready: function() {
    },
    keypressAction: function (){
      console.log("asd");
      var x=document.createElement('img');
      x.src="http://cl.ly/image/1x260j3K0p0V/sunglasses.png";
      insertNodeOverSelection(x, this.$.input);
    }
  });
  function isOrContainsNode(ancestor, descendant) {
    var node = descendant;
    while (node) {
      if (node === ancestor) {
        return true;
      }
      node = node.parentNode;
    }
    return false;
  }

  function insertNodeOverSelection(node, containerNode) {
    var sel, range, html, str;
    if (window.getSelection) {
      sel = window.getSelection();
      if (sel.getRangeAt && sel.rangeCount) {
        range = sel.getRangeAt(0);
        if (isOrContainsNode(containerNode, range.commonAncestorContainer)) {
          range.deleteContents();
          range.insertNode(node);
        } else {
          containerNode.appendChild(node);
        }
      }
    } else if (document.selection && document.selection.createRange) {
      range = document.selection.createRange();
      if (isOrContainsNode(containerNode, range.parentElement())) {
        html = (node.nodeType == 3) ? node.data : node.outerHTML;
        range.pasteHTML(html);
      } else {
        containerNode.appendChild(node);
      }
    }
  }
  </script>
</polymer-element>
